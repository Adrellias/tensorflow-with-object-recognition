# Make any security camera smarter for less than $50 using Tensorflow

Background to this story. I bought recently a Xiaomi security camera from GearBest(https://www.gearbest.com/ip-cameras/pp_615275.html?wid=1433363).
On its own this camera is already quite good. It has 1080p resolution and comes with the MiHome app. You can configure the camera using a schedule and when it detects movement it will send you a notification to your mobile. But here lies the problem. The camera sends you quite a few alerts and only a small percentage will be because a person was detected. Many times, just noise(such as train), a fly going past will trigger the camera. This is not necessarily a bad thing, especially the sound feature, as it can be used for a variety of scenarios in the future. But to be useful in terms of security it needs to only trigger alerts for scenarios which are of real concern. Too many false positives and you end up ignoring the warnings. And one day that one warning you dismissed might be your intruder!

The camera doesn't come with real "cloud storage". Surprisingly it still somehow uploads videos via the MiHome app onto the cloud in order to send you the notifications. Also it runs some AI algorithms in the cloud which will also give an insight whether a person was detected in the video. Unfortunately this feature is not used to filter the pointless notifications. 

If you add a memory card the camera will be able to save all its videos in a NAS storage location. And that is exactly what you need.

The goal of this project is to create an application that processes all the videos generated by my Xiaomi security camera and do a visual inspection of each to ensure that only videos where a person is detected will trigger a notification. When you receive this notification, you would be able to see a screenshot of what triggered the camera with a bounding box and also the original video for closer inspection.


## Sources I have used

To be able to build something like a smart camera, you need to stand on the shoulder of giants.
First port of call for me was 

### Youtube with its many videos teaching tensorflow and openCV.

I followed this series:

Tensorflow Object Detection API Tutorial Part 1 - https://www.youtube.com/watch?v=COlbP62-B-U&t=121s

and 

Train an Image Classifier in 3 Minutes - https://www.youtube.com/watch?v=qbFF1r4NGmA&t=14s

### Tensorflow Object Detection API

https://github.com/tensorflow/models/tree/master/research/object_detection

###  Train an Image Classifier in 3 Minutes - Tutorial

https://askmacgyver.com/blog/tutorial/create-image-classifier

This tutorial, alongside the youtube video, helped me getting introduced to image classification with Tensorflow and I used the tensorflow docker instance created by Macgyver as my starting point.
 
https://askmacgyver.com/blog/tutorial/create-image-classifier

## Tools for this project

### Tensorflow

Tensorflow is incredibly powerful and comes with pre-built models that are quite capable to detect something as simple as a person. In fact it can do a lot more than that. The code written uses Tensorflow Object Detection API, which is still in ongoing development.
https://github.com/tensorflow/models/tree/master/research/object_detection. As a starting point I used the object detection tutorial python script. 

### OpenCV

Second tool used is OpenCV.
OpenCV (Open Source Computer Vision Library) is an open source computer vision and machine learning software library. OpenCV Is used to process each frame of the video and apply a Tensorflow model.

### Docker

Used to create a container that runs the code for use in any machine that runs docker.

### Slack

Slack is a messaging system used by software development teams around the world. It is used to deliver notifications to your mobile without having to write a mobile app.

### Python

AI's language of choice is Python, and Tensorflow was written in Python. No surprise why we need it.

### STEP 1 - BUY VIDEO SECURITY CAMERA and MEMORY STICK

1. Buy a video security camera such as the Xiaomi Mijia Camera. There are many types of security cameras out there. The setup instructions I am providing here only work for Xiaomi Mijia camera, as that is the one that I purchased. In theory you can buy any camera and as long as you get the camera to save the videos into a NAS storage, that's ok.
The camera doesn't come with a memory stick. In order for the NAS share feature to work you need a memory stick. In this case I recommend 16gb size.

### STEP 2 - CONFIGURE XIAOMI MIJIA CAMERA

Download the MiHome app and setup the camera per instructions. Plenty of Youtube videos that help you on this. Here is one: https://www.youtube.com/watch?v=QXDv1RsccSs
You need to create a NAS share somewhere in your network, to which the camera can upload any videos once motion is detected.
In my home I setup a SMB share on a Raspberry Pi.

### STEP 3 - RUN DOCKER CONTAINER

Once you have the Xiaomi Mijia Camera installed and configured to dump all the videos into a NAS share, you are ready to start the process of setting up the docker container. But you need to install docker first. Don't know docker? Read this: https://docs.docker.com/get-started/

1. Build docker container

``` bash
docker build -t armindocachada/tensorflow-with-object-recognition .
```

2. Start docker container

Pass the -v to share the folder with the docker container in which the camera's surveillance files will be available. You need read/write access to the folder.

Pass the -p to expose the port to access the jupyter notebook

docker run -i -t -d -p 8888:8888 -v <NAS FOLDER WITH VIDEOS>:/data/videos/incoming armindocachada/tensorflow-with-object-recognition /bin/bash



 docker exec -it <CONTAINER ID> /bin/bash -c "export COLUMNS=tput cols; export LINES=tput lines; exec bash"

